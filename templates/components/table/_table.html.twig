{# INDEX TABLE COMPONENT #}

{# Initialisation des variables #}
{% set items = items is defined ? items : [] %}
{% set columns = columns is defined ? columns : [] %}
{% set headers = headers is defined ? headers : null %}
{% set table_id = 'table_' ~ random() %}
{% set filter = filter is defined ? filter : false %}
{% set sort = sort is defined ? sort : false %}
{% set row_actions = actions|default([]) %}
{% set has_row_actions = row_actions|length > 0 %}
{% set add_action = add|default(null) %}

{% import 'components/table/_table_cell.html.twig' as cell_format %}

{# Add button (if no filters) #}
{% if add_action is not null and add_action.route is defined and not filter %}
    <div class="text-end">
        {% include 'components/button/_btn_new.html.twig' with {
            route: add_action.route,
            params: add_action.params|default({})
        } %}
    </div>
{% endif %}




{# Header #}
<table class="table table-hover align-middle" id="{{ table_id }}">
    <thead class="table-light">
    <tr>
        {% for header in headers %}
            <th>{{ header }}</th>
        {% endfor %}
        {% if has_row_actions %}
            <th></th>
        {% endif %}
    </tr>

    {# Filters and sorts row #}
    {% if filter or sort %}
        <tr class="filter-row">
            {% for column in columns %}
                {% set column_index = loop.index0 %}
                <td class="position-relative">
                    <div class="d-flex gap-1">
                        {% if filter %}
                            <input type="text" class="form-control form-control-sm filter"
                                   placeholder="Filtrer {{ headers[column_index] ?? column }}"
                                   oninput="filterTable(this)" data-filter-column="{{ column_index }}"
                                   data-table-id="{{ table_id }}">
                        {% endif %}
                        {% if sort %}
                            <button type="button" class="btn btn-sm"
                                    onclick="sortTable('{{ table_id }}', {{ column_index }})"
                                    title="Trier cette colonne">
                                <i class="bi bi-sort-alpha-down"></i>
                            </button>
                        {% endif %}
                    </div>
                </td>
            {% endfor %}
            {% if has_row_actions %}
                <td class="table-actions">
                    {% if add_action is not null and add_action.route is defined %}
                        {% include 'components/button/_btn_new.html.twig' with {
                            route: add_action.route,
                            params: add_action.params|default({})
                        } %}
                    {% endif %}
                </td>
            {% endif %}
        </tr>
    {% endif %}
    </thead>

    <tbody>
    {% for item in items %}
        <tr>
            {# Values #}
            {% for property in columns %}
                {% set value = attribute_chain(item, property) %}
                <td>{{ cell_format.value(value) }}</td>
            {% endfor %}

            {# Action buttons #}
                {% if has_row_actions %}
                    <td class="text-nowrap btn-fixed-width">
                        {% include 'components/table/_table_row_actions.html.twig' with {
                            actions: row_actions,
                            item: item,
                            default_btn_class: 'btn btn-outline-primary btn-sm'
                        } %}
                    </td>
                {% endif %}
        </tr>
    {% else %}
        <tr>
            <td colspan="{{ columns|length + (has_row_actions ? 1 : 0) }}" class="text-muted text-center">
        </tr>
    {% endfor %}
    </tbody>
</table>
